"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[210],{24861:function(Me,U,d){d.r(U);var J=d(15009),c=d.n(J),X=d(99289),h=d.n(X),q=d(5574),v=d.n(q),x=d(59955),ee=d(78301),w=d(42119),i=d(2453),ue=d(33900),re=d(36039),ae=d(78957),y=d(77683),se=d(60801),ne=d(38703),te=d(40056),f=d(67294),a=d(85893),M=ee.Z.Text,_=w.Z.Step,le=function(){var ie=(0,f.useState)(""),I=v()(ie,2),de=I[0],ce=I[1],pe=(0,f.useState)(!1),Z=v()(pe,2),k=Z[0],C=Z[1],Ee=(0,f.useState)(0),R=v()(Ee,2),L=R[0],S=R[1],Fe=(0,f.useState)(!1),W=v()(Fe,2),me=W[0],K=W[1],fe=(0,f.useState)(10),$=v()(fe,2),oe=$[0],Ae=$[1],he=(0,f.useState)(""),G=v()(he,2),B=G[0],ve=G[1],Ce=(0,f.useState)(!0),V=v()(Ce,2),De=V[0],Q=V[1],ge=(0,f.useState)(!1),H=v()(ge,2),Be=H[0],be=H[1],Pe=(0,f.useState)(0),N=v()(Pe,2),T=N[0],D=N[1],F=x.S.getInstance(),Y=function(){var p=h()(c()().mark(function l(){var n,E,s;return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,K(!0),r.next=4,F.sendCommand("AT+CGMR");case 4:n=r.sent,n.success&&typeof n.data=="string"&&(E=n.data.replace(/\r/g,""),s=E.split(`
`).map(function(m){return m.trim()}).filter(function(m){return m&&m.toUpperCase()!=="OK"&&!/^AT\+CGMR/i.test(m)}),ce(s[0]||n.data.trim())),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),i.ZP.error("\u83B7\u53D6\u5F53\u524D\u7248\u672C\u4FE1\u606F\u5931\u8D25");case 11:return r.prev=11,K(!1),r.finish(11);case 14:case"end":return r.stop()}},l,null,[[0,8,11,14]])}));return function(){return p.apply(this,arguments)}}();(0,f.useEffect)(function(){var p=function(){var l=h()(c()().mark(function n(){var E;return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.connect();case 3:E=e.sent,E&&Y(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0.message==="REQUIRE_AUTH_KEY"?console.log("System/Upgrade: \u7B49\u5F85\u5BC6\u94A5\u8BA4\u8BC1..."):console.error("\u8FDE\u63A5\u5931\u8D25:",e.t0);case 10:case"end":return e.stop()}},n,null,[[0,7]])}));return function(){return l.apply(this,arguments)}}();return p(),function(){F.disconnect()}},[]);var _e=function(){var p=h()(c()().mark(function l(){var n,E;return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.sendCommand("AT+COPS?");case 3:if(n=e.sent,n.success){e.next=6;break}throw new Error("\u7F51\u7EDC\u672A\u6CE8\u518C");case 6:return e.next=8,F.sendCommand("AT+CREG?");case 8:if(E=e.sent,E.success){e.next=11;break}throw new Error("\u62E8\u53F7\u72B6\u6001\u5F02\u5E38");case 11:return e.abrupt("return",!0);case 14:return e.prev=14,e.t0=e.catch(0),console.error("\u7F51\u7EDC\u72B6\u6001\u68C0\u67E5\u5931\u8D25:",e.t0),e.abrupt("return",!1);case 18:case"end":return e.stop()}},l,null,[[0,14]])}));return function(){return p.apply(this,arguments)}}(),je=function(){var p=h()(c()().mark(function l(){var n;return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,F.sendCommand("ATE0");case 3:return s.next=5,_e();case 5:if(n=s.sent,n){s.next=8;break}throw new Error("\u7F51\u7EDC\u72B6\u6001\u5F02\u5E38");case 8:return s.next=10,F.sendCommand("AT^FOTAMODE=0,1,0,1");case 10:return s.abrupt("return",!0);case 13:return s.prev=13,s.t0=s.catch(0),i.ZP.error("FOTA\u521D\u59CB\u5316\u914D\u7F6E\u5931\u8D25"),s.abrupt("return",!1);case 17:case"end":return s.stop()}},l,null,[[0,13]])}));return function(){return p.apply(this,arguments)}}(),z=function(){var p=h()(c()().mark(function l(){var n,E;return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.sendCommand("AT^FOTASTATE?");case 3:if(n=e.sent,!(n.success&&typeof n.data=="string")){e.next=8;break}return E=parseInt(n.data.split(":")[1].trim()),Ae(E),e.abrupt("return",E);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("\u67E5\u8BE2FOTA\u72B6\u6001\u5931\u8D25:",e.t0);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}},l,null,[[0,10]])}));return function(){return p.apply(this,arguments)}}(),ke=function(){var p=h()(c()().mark(function l(){var n;return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=setInterval(h()(c()().mark(function e(){var r,m,o,g,A,b;return c()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z();case 2:r=t.sent,t.t0=r,t.next=t.t0===40?6:t.t0===50?13:t.t0===20?15:t.t0===30?19:30;break;case 6:return clearInterval(n),i.ZP.success("\u56FA\u4EF6\u4E0B\u8F7D\u5B8C\u6210"),t.next=10,F.sendCommand("AT^FWUP");case 10:return i.ZP.success("\u56FA\u4EF6\u5347\u7EA7\u5DF2\u5F00\u59CB,\u8BBE\u5907\u5373\u5C06\u91CD\u542F"),C(!1),t.abrupt("break",30);case 13:return i.ZP.info("\u6B63\u5728\u51C6\u5907\u5347\u7EA7..."),t.abrupt("break",30);case 15:return clearInterval(n),i.ZP.error("\u56FA\u4EF6\u4E0B\u8F7D\u5931\u8D25"),C(!1),t.abrupt("break",30);case 19:return t.prev=19,t.next=22,F.sendCommand("AT^FOTADLQ");case 22:m=t.sent,m.success&&typeof m.data=="string"&&(o=m.data.replace(/\r|\n/g,"").split(",").map(function(P){return P.replace(/[^0-9]/g,"")}).filter(function(P){return P.length>0}).map(function(P){return parseInt(P,10)}),o.length>=2&&(g=o[o.length-2],A=o[o.length-1],g>0&&A>=0&&(b=Math.max(0,Math.min(100,Math.floor(A/g*100))),S(b)))),t.next=29;break;case 26:t.prev=26,t.t1=t.catch(19),console.error("\u67E5\u8BE2\u4E0B\u8F7D\u8FDB\u5EA6\u5931\u8D25:",t.t1);case 29:return t.abrupt("break",30);case 30:case"end":return t.stop()}},e,null,[[19,26]])})),1e3),s.abrupt("return",function(){return clearInterval(n)});case 2:case"end":return s.stop()}},l)}));return function(){return p.apply(this,arguments)}}(),Te=function(){var p=h()(c()().mark(function l(){var n,E,s;return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(B){r.next=3;break}return i.ZP.error("\u8BF7\u8BBE\u7F6EFOTA\u670D\u52A1\u5668\u5730\u5740"),r.abrupt("return");case 3:if(B.startsWith("http://")){r.next=6;break}return i.ZP.error("\u8BF7\u4F7F\u7528http\u534F\u8BAE\u7684FOTA\u670D\u52A1\u5668\u5730\u5740"),r.abrupt("return");case 6:return n=B.endsWith("/")?B:"".concat(B,"/"),r.prev=7,C(!0),S(0),D(1),r.next=13,F.sendCommand("ATE0");case 13:return r.next=15,F.sendCommand("AT^FOTAMODE=0,1,0,1");case 15:return D(2),r.next=18,F.sendCommand('AT^FOTAOEMDL="'.concat(n,'"'));case 18:if(E=r.sent,E.success){r.next=24;break}return i.ZP.error("\u8BBE\u7F6EFOTA\u670D\u52A1\u5668\u5730\u5740\u5931\u8D25"),C(!1),D(0),r.abrupt("return");case 24:s=setInterval(h()(c()().mark(function m(){var o,g,A,b,j,t;return c()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,z();case 2:o=u.sent,u.t0=o,u.next=u.t0===10?6:u.t0===11?8:u.t0===12?10:u.t0===13?12:u.t0===14?17:u.t0===20?22:u.t0===30?27:u.t0===31?38:u.t0===40?42:u.t0===50?50:52;break;case 6:return i.ZP.info("\u7B49\u5F85\u4E0B\u8F7D..."),u.abrupt("break",54);case 8:return i.ZP.info("\u6B63\u5728\u67E5\u8BE2\u65B0\u7248\u672C..."),u.abrupt("break",54);case 10:return i.ZP.info("\u53D1\u73B0\u65B0\u7248\u672C..."),u.abrupt("break",54);case 12:return clearInterval(s),i.ZP.error("\u67E5\u8BE2\u65B0\u7248\u672C\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC"),C(!1),D(0),u.abrupt("break",54);case 17:return clearInterval(s),i.ZP.error("\u670D\u52A1\u5668\u65E0\u65B0\u7248\u672C"),C(!1),D(0),u.abrupt("break",54);case 22:return clearInterval(s),i.ZP.error("\u56FA\u4EF6\u4E0B\u8F7D\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u548C\u5B58\u50A8"),C(!1),D(0),u.abrupt("break",54);case 27:return u.prev=27,u.next=30,F.sendCommand("AT^FOTADLQ");case 30:g=u.sent,g.success&&typeof g.data=="string"&&(A=g.data.replace(/\r|\n/g,"").split(",").map(function(O){return O.replace(/[^0-9]/g,"")}).filter(function(O){return O.length>0}).map(function(O){return parseInt(O,10)}),A.length>=2&&(b=A[A.length-2],j=A[A.length-1],b>0&&j>=0&&(t=Math.max(0,Math.min(100,Math.floor(j/b*100))),S(t)))),u.next=37;break;case 34:u.prev=34,u.t1=u.catch(27),console.error("\u67E5\u8BE2\u4E0B\u8F7D\u8FDB\u5EA6\u5931\u8D25:",u.t1);case 37:return u.abrupt("break",54);case 38:return i.ZP.info("\u4E0B\u8F7D\u6302\u8D77\uFF0C\u5C1D\u8BD5\u7EED\u4F20..."),u.next=41,F.sendCommand("AT^FOTADL=1");case 41:return u.abrupt("break",54);case 42:return clearInterval(s),i.ZP.success("\u56FA\u4EF6\u4E0B\u8F7D\u5B8C\u6210"),D(3),u.next=47,F.sendCommand("AT^FWUP");case 47:return i.ZP.success("\u56FA\u4EF6\u5347\u7EA7\u5DF2\u5F00\u59CB,\u8BBE\u5907\u5373\u5C06\u91CD\u542F"),C(!1),u.abrupt("break",54);case 50:return i.ZP.info("\u6B63\u5728\u51C6\u5907\u5347\u7EA7..."),u.abrupt("break",54);case 52:return i.ZP.info("\u5F53\u524D\u72B6\u6001: ".concat(o)),u.abrupt("break",54);case 54:case"end":return u.stop()}},m,null,[[27,34]])})),1e3),r.next=34;break;case 27:r.prev=27,r.t0=r.catch(7),console.error("\u5347\u7EA7\u5931\u8D25:",r.t0),i.ZP.error("\u56FA\u4EF6\u5347\u7EA7\u5931\u8D25"),C(!1),S(0),D(0);case 34:case"end":return r.stop()}},l,null,[[7,27]])}));return function(){return p.apply(this,arguments)}}(),Oe=function(){be(!0),Q(!1)};return Be?(0,a.jsx)(re.Z,{title:"\u7CFB\u7EDF\u5347\u7EA7",children:(0,a.jsxs)(ae.Z,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(M,{strong:!0,children:"\u5F53\u524D\u7248\u672C\uFF1A"}),(0,a.jsx)(M,{children:de||"\u672A\u77E5"}),(0,a.jsx)(y.ZP,{style:{marginLeft:16},onClick:Y,loading:me,children:"\u5237\u65B0"})]}),(0,a.jsxs)(w.Z,{current:T,children:[(0,a.jsx)(_,{title:"\u51C6\u5907",description:"\u8BBE\u7F6E\u5347\u7EA7\u53C2\u6570"}),(0,a.jsx)(_,{title:"\u521D\u59CB\u5316",description:"\u521D\u59CB\u5316FOTA\u73AF\u5883"}),(0,a.jsx)(_,{title:"\u4E0B\u8F7D",description:"\u4E0B\u8F7D\u56FA\u4EF6\u6587\u4EF6"}),(0,a.jsx)(_,{title:"\u5347\u7EA7",description:"\u6267\u884C\u56FA\u4EF6\u5347\u7EA7"}),(0,a.jsx)(_,{title:"\u5B8C\u6210",description:"\u5347\u7EA7\u5B8C\u6210"})]}),T===0&&(0,a.jsxs)("div",{children:[(0,a.jsx)(M,{strong:!0,children:"FOTA\u670D\u52A1\u5668\u5730\u5740\uFF1A"}),(0,a.jsx)(se.Z,{value:B,onChange:function(l){return ve(l.target.value)},placeholder:"\u8BF7\u8F93\u5165FOTA\u670D\u52A1\u5668\u5730\u5740",style:{width:"60%",marginRight:16}}),(0,a.jsx)(M,{type:"secondary",children:"\u4EC5\u652F\u6301http\u534F\u8BAE"})]}),T===0&&(0,a.jsx)(y.ZP,{type:"primary",onClick:Te,loading:k,disabled:k,children:"\u5F00\u59CB\u5347\u7EA7"}),(T===2||T===3)&&(0,a.jsx)("div",{style:{marginTop:16},children:(0,a.jsx)(ne.Z,{percent:L,status:L===100?"success":"active",format:function(l){return"".concat(l,"% ").concat(oe===50?"(\u6B63\u5728\u5347\u7EA7...)":"")}})}),k&&(0,a.jsx)(te.Z,{message:"\u5347\u7EA7\u63D0\u793A",description:"\u56FA\u4EF6\u5347\u7EA7\u8FC7\u7A0B\u4E2D\u8BF7\u52FF\u65AD\u7535\u6216\u6267\u884C\u5176\u4ED6\u64CD\u4F5C,\u5347\u7EA7\u5B8C\u6210\u540E\u8BBE\u5907\u5C06\u81EA\u52A8\u91CD\u542F\u3002",type:"warning",showIcon:!0})]})}):(0,a.jsx)(ue.Z,{title:"\u514D\u8D23\u58F0\u660E",open:De,onOk:Oe,onCancel:function(){return Q(!1)},okText:"\u540C\u610F\u5E76\u7EE7\u7EED",cancelText:"\u4E0D\u540C\u610F",width:600,children:(0,a.jsxs)("div",{style:{maxHeight:"400px",overflowY:"auto"},children:[(0,a.jsx)("h3",{children:"\u56FA\u4EF6\u5347\u7EA7\u514D\u8D23\u58F0\u660E"}),(0,a.jsx)("p",{children:"\u5728\u8FDB\u884C\u56FA\u4EF6\u5347\u7EA7\u4E4B\u524D\uFF0C\u8BF7\u4ED4\u7EC6\u9605\u8BFB\u4EE5\u4E0B\u5185\u5BB9\uFF1A"}),(0,a.jsxs)("ol",{children:[(0,a.jsx)("li",{children:"\u56FA\u4EF6\u5347\u7EA7\u8FC7\u7A0B\u4E2D\u8BF7\u786E\u4FDD\u8BBE\u5907\u4F9B\u7535\u7A33\u5B9A\uFF0C\u5207\u52FF\u65AD\u7535\u3002"}),(0,a.jsx)("li",{children:"\u5347\u7EA7\u8FC7\u7A0B\u4E2D\u8BF7\u52FF\u8FDB\u884C\u5176\u4ED6\u64CD\u4F5C\uFF0C\u4EE5\u514D\u5F71\u54CD\u5347\u7EA7\u8FDB\u7A0B\u3002"}),(0,a.jsx)("li",{children:"\u5347\u7EA7\u5B8C\u6210\u540E\u8BBE\u5907\u5C06\u81EA\u52A8\u91CD\u542F\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\u3002"}),(0,a.jsx)("li",{children:"\u5982\u56E0\u64CD\u4F5C\u4E0D\u5F53\u5BFC\u81F4\u5347\u7EA7\u5931\u8D25\uFF0C\u53EF\u80FD\u9020\u6210\u8BBE\u5907\u65E0\u6CD5\u6B63\u5E38\u4F7F\u7528\u3002"}),(0,a.jsx)("li",{children:"\u5347\u7EA7\u524D\u8BF7\u786E\u4FDD\u5DF2\u5907\u4EFD\u91CD\u8981\u6570\u636E\u3002"}),(0,a.jsx)("li",{children:"\u5347\u7EA7\u8FC7\u7A0B\u4E2D\u5982\u9047\u5F02\u5E38\uFF0C\u8BF7\u53CA\u65F6\u8054\u7CFB\u6280\u672F\u652F\u6301\u3002"})]}),(0,a.jsx)("p",{children:'\u70B9\u51FB"\u540C\u610F\u5E76\u7EE7\u7EED"\u5373\u8868\u793A\u60A8\u5DF2\u9605\u8BFB\u5E76\u540C\u610F\u4EE5\u4E0A\u5185\u5BB9\uFF0C\u5E76\u613F\u610F\u627F\u62C5\u5347\u7EA7\u8FC7\u7A0B\u4E2D\u53EF\u80FD\u4EA7\u751F\u7684\u98CE\u9669\u3002'})]})})};U.default=le}}]);
