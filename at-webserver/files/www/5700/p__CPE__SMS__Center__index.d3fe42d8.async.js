"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[90],{6038:function(pr,Le,y){y.r(Le),y.d(Le,{default:function(){return Un}});var gn=y(19632),W=y.n(gn),mn=y(97857),re=y.n(mn),pn=y(64599),he=y.n(pn),Sn=y(15009),A=y.n(Sn),Cn=y(99289),K=y.n(Cn),yn=y(5574),Z=y.n(yn),x=y(67294),Ge=y(60801),Me=y(26058),bn=y(78301),z=y(2453),ke=y(33900),ge=y(2487),En=y(84567),Fn=y(16568),Tn=y(36039),je=y(78957),wn=y(38703),te=y(77683),Bn=y(68997),Dn=y(40411),xe=y(27496),An=y(98165),Mn=y(87547),kn=y(38545),jn=y(59955),xn=y(12444),Zn=y.n(xn),Nn=y(72004),Pn=y.n(Nn),In=function(){function Ce(){Zn()(this,Ce)}return Pn()(Ce,[{key:"stringToHex",value:function(w){return Array.from(w).map(function(T){return T.charCodeAt(0).toString(16).padStart(2,"0")}).join("").toUpperCase()}},{key:"encodeGSM7bit",value:function(w){for(var T="",C=0;C<w.length;C++){var X=w.charCodeAt(C)&127;T+=X.toString(2).padStart(7,"0")}var Y=(8-T.length%8)%8;Y&&(T+="0".repeat(Y));for(var H="",M=0;M<T.length;M+=8)H+=parseInt(T.substring(M,M+8),2).toString(16).padStart(2,"0");return H.toUpperCase()}},{key:"encodeUCS2",value:function(w){for(var T="",C=0;C<w.length;C++){var X=w.charCodeAt(C);T+=X.toString(16).padStart(4,"0")}return T.toUpperCase()}},{key:"hexToBytes",value:function(w){if(w.length%2!==0)throw new Error("Invalid hex string length");for(var T=new Uint8Array(w.length/2),C=0;C<w.length;C+=2)T[C/2]=parseInt(w.substring(C,C+2),16);return T}},{key:"encodeNumber",value:function(w){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!w)throw new Error("Number is required");for(var C=w.startsWith("+")?w.slice(1):w,X=C.length,Y=X%2===0?C:C+"F",H="",M=0;M<Y.length;M+=2)H+=Y[M+1]+Y[M];var ue="91"+H,oe=T?Math.floor(ue.length/2):X;return oe.toString(16).padStart(2,"0")+ue}},{key:"encode",value:function(w){try{var T=this.encodeNumber(w.smsc,!0),C="11",X="00",Y=this.encodeNumber(w.destination),H="00",M=w.encoding||"7bit",ue=M==="ucs2"?"08":"00",oe=M==="ucs2"?this.encodeUCS2(w.message):this.encodeGSM7bit(w.message),B=M==="ucs2"?w.message.length*2:w.message.length,_=w.validityPeriod?Math.min(Math.max(w.validityPeriod,0),40320).toString(16).padStart(2,"0"):"AA",ye="".concat(C).concat(X).concat(Y).concat(H).concat(ue).concat(_).concat(B.toString(16).padStart(2,"0")).concat(oe),be="".concat(T).concat(ye),le=ye.length/2;return{pdu:be,tpduLength:le}}catch(ce){throw new Error("PDU encoding failed: ".concat(ce.message))}}}]),Ce}(),On=y(96486),Ze=y(36009),l=y(85893),Ue=Ge.Z.TextArea,zn=Me.Z.Sider,Ln=Me.Z.Content,me=bn.Z.Text,Gn=function(){var ae=(0,x.useState)([]),w=Z()(ae,2),T=w[0],C=w[1],X=(0,x.useState)([]),Y=Z()(X,2),H=Y[0],M=Y[1],ue=(0,x.useState)(""),oe=Z()(ue,2),B=oe[0],_=oe[1],ye=(0,x.useState)(""),be=Z()(ye,2),le=be[0],ce=be[1],Wn=(0,x.useState)(""),We=Z()(Wn,2),Ne=We[0],Pe=We[1],Hn=(0,x.useState)(!1),He=Z()(Hn,2),fe=He[0],ee=He[1],Jn=(0,x.useState)(!1),Je=Z()(Jn,2),Kn=Je[0],Ee=Je[1],Yn=(0,x.useState)(!1),Ke=Z()(Yn,2),Qn=Ke[0],Fe=Ke[1],Vn=(0,x.useState)(!1),Ye=Z()(Vn,2),se=Ye[0],Qe=Ye[1],Xn=(0,x.useState)([]),Ve=Z()(Xn,2),Q=Ve[0],ie=Ve[1],Rn=(0,x.useState)(!1),Xe=Z()(Rn,2),Re=Xe[0],$e=Xe[1],$n=(0,x.useState)({used:0,total:0}),qe=Z()($n,2),de=qe[0],qn=qe[1],_n=(0,x.useState)(!0),_e=Z()(_n,2),en=_e[0],er=_e[1],nr=(0,x.useState)(!1),nn=Z()(nr,2),Sr=nn[0],Cr=nn[1],rr=(0,x.useState)(!1),rn=Z()(rr,2),tn=rn[0],an=rn[1],tr=(0,x.useState)(!0),sn=Z()(tr,2),pe=sn[0],ar=sn[1],J=jn.S.getInstance(),Ie=(0,x.useRef)(new Map),Se="sms_sent_messages_cache",un=1e3,sr=function(e){try{var n=Te();n.push(e),n.length>un&&n.splice(0,n.length-un),localStorage.setItem(Se,JSON.stringify(n)),console.log("\u53D1\u9001\u7684\u6D88\u606F\u5DF2\u4FDD\u5B58\u5230\u672C\u5730\u7F13\u5B58:",e)}catch(a){console.error("\u4FDD\u5B58\u53D1\u9001\u6D88\u606F\u5230\u7F13\u5B58\u5931\u8D25:",a)}},Te=function(){try{var e=localStorage.getItem(Se);if(e){var n=JSON.parse(e);return console.log("\u4ECE\u672C\u5730\u7F13\u5B58\u52A0\u8F7D\u53D1\u9001\u7684\u6D88\u606F:",n.length,"\u6761"),Array.isArray(n)?n:[]}}catch(a){console.error("\u4ECE\u672C\u5730\u7F13\u5B58\u52A0\u8F7D\u53D1\u9001\u6D88\u606F\u5931\u8D25:",a)}return[]},yr=function(){try{localStorage.removeItem(Se),console.log("\u5DF2\u6E05\u7A7A\u53D1\u9001\u6D88\u606F\u7F13\u5B58")}catch(e){console.error("\u6E05\u7A7A\u53D1\u9001\u6D88\u606F\u7F13\u5B58\u5931\u8D25:",e)}},on=function(){var f=K()(A()().mark(function e(n){var a,u,t,i=arguments;return A()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=i.length>1&&i[1]!==void 0?i[1]:!1,u=n,!(!a&&Ie.current.has(u))){r.next=4;break}return r.abrupt("return",Ie.current.get(u));case 4:return r.next=6,J.sendCommand(n);case 6:return t=r.sent,t.success&&Ie.current.set(u,t),r.abrupt("return",t);case 9:case"end":return r.stop()}},e)}));return function(n){return f.apply(this,arguments)}}(),we=function(){var f=K()(A()().mark(function e(){var n,a,u;return A()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,J.getSMSStorage();case 3:n=i.sent,n.success&&n.data&&(a=String(n.data),u=a.match(/\+CPMS: "\w+",(\d+),(\d+)/),u&&qn({used:parseInt(u[1]),total:parseInt(u[2])})),i.next=10;break;case 7:i.prev=7,i.t0=i.catch(0),console.error("\u83B7\u53D6\u5B58\u50A8\u7A7A\u95F4\u4FE1\u606F\u5931\u8D25:",i.t0);case 10:case"end":return i.stop()}},e,null,[[0,7]])}));return function(){return f.apply(this,arguments)}}(),ir=function(){var f=K()(A()().mark(function e(){var n,a,u,t;return A()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,console.log("\u5F00\u59CB\u521D\u59CB\u5316SMS\u4E2D\u5FC3..."),s.next=4,J.connect();case 4:if(n=s.sent,console.log("WebSocket\u8FDE\u63A5\u72B6\u6001:",n),!n){s.next=32;break}return console.log("\u68C0\u67E5IMS\u72B6\u6001..."),s.next=10,on("AT^IMSSWITCH?");case 10:return a=s.sent,console.log("IMS\u72B6\u6001\u68C0\u67E5\u7ED3\u679C:",a),a.success&&a.data&&(u=a.data.includes(": 1"),ar(u),u||z.ZP.warning("IMS\u529F\u80FD\u672A\u5F00\u542F\uFF0C\u77ED\u4FE1\u529F\u80FD\u4E0D\u53EF\u7528")),console.log("\u68C0\u67E5\u77ED\u4FE1\u529F\u80FD\u662F\u5426\u5F00\u542F..."),s.next=16,on("AT+CMGF?");case 16:if(t=s.sent,console.log("\u77ED\u4FE1\u529F\u80FD\u68C0\u67E5\u7ED3\u679C:",t),t.success){s.next=22;break}return z.ZP.warning("\u77ED\u4FE1\u529F\u80FD\u672A\u5F00\u542F\u6216\u4E0D\u53EF\u7528\uFF0C\u8BF7\u5148\u524D\u5F80\u8BBE\u7F6E\u9875\u9762\u5F00\u542F\u77ED\u4FE1\u529F\u80FD"),$e(!1),s.abrupt("return");case 22:return $e(!0),console.log("\u77ED\u4FE1\u529F\u80FD\u5DF2\u5F00\u542F"),console.log("\u83B7\u53D6\u5B58\u50A8\u7A7A\u95F4\u4FE1\u606F..."),s.next=27,we();case 27:return console.log("\u5F00\u59CB\u5237\u65B0\u77ED\u4FE1\u5217\u8868..."),s.next=30,ve();case 30:s.next=34;break;case 32:console.log("\u8FDE\u63A5\u5931\u8D25"),z.ZP.error("\u8FDE\u63A5\u670D\u52A1\u5668\u5931\u8D25");case 34:s.next=40;break;case 36:s.prev=36,s.t0=s.catch(0),console.error("\u521D\u59CB\u5316\u5931\u8D25:",s.t0),z.ZP.error("\u521D\u59CB\u5316\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u8FDE\u63A5");case 40:case"end":return s.stop()}},e,null,[[0,36]])}));return function(){return f.apply(this,arguments)}}();(0,x.useEffect)(function(){return ir(),function(){console.log("\u7EC4\u4EF6\u5378\u8F7D\uFF0C\u4E0D\u65AD\u5F00\u8FDE\u63A5\u4EE5\u907F\u514D\u5F71\u54CD\u5176\u4ED6\u9875\u9762")}},[]),(0,x.useEffect)(function(){if(B){console.log("\u9009\u62E9\u4E86\u8054\u7CFB\u4EBA:",B),C([]);var f=H.find(function(e){return b(e.number)===b(B)});f&&f.messages&&f.messages.length>0?(console.log("\u4ECE\u7F13\u5B58\u4E2D\u52A0\u8F7D\u8054\u7CFB\u4EBA\u6D88\u606F:",f.messages.length,"\u6761"),C(f.messages.sort(function(e,n){var a=U(e.time),u=U(n.time);return a.getTime()-u.getTime()}))):(console.log("\u4ECE\u670D\u52A1\u5668\u52A0\u8F7D\u8054\u7CFB\u4EBA\u6D88\u606F"),setTimeout(function(){ur(B)},100))}},[B,H]),(0,x.useEffect)(function(){console.log("\u6D88\u606F\u5217\u8868\u5DF2\u66F4\u65B0:",T)},[T]);var ur=function(){var f=K()(A()().mark(function e(n){var a,u,t,i;return A()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,ee(!0),console.log("\u5F00\u59CB\u52A0\u8F7D\u8054\u7CFB\u4EBA ".concat(n," \u7684\u6D88\u606F")),r.next=5,J.listAllSMS();case 5:if(a=r.sent,a.success){r.next=9;break}throw console.error("\u83B7\u53D6\u77ED\u4FE1\u5217\u8868\u5931\u8D25:",a.error),new Error("\u83B7\u53D6\u77ED\u4FE1\u5217\u8868\u5931\u8D25");case 9:if(!(!a.data||a.data==="NO SMS"||a.data==="OK")){r.next=13;break}return console.log("\u6CA1\u6709\u77ED\u4FE1\u6216\u54CD\u5E94\u4E3A\u7A7A"),C([]),r.abrupt("return");case 13:console.log("\u6210\u529F\u83B7\u53D6\u77ED\u4FE1\u5217\u8868\uFF0C\u5F00\u59CB\u89E3\u6790\u6D88\u606F"),u=Be(typeof a.data=="string"?a.data:JSON.stringify(a.data)),t=b(n),console.log("\u89E3\u6790\u5230 ".concat(u.length," \u6761\u77ED\u4FE1\uFF0C\u7B5B\u9009\u8054\u7CFB\u4EBA ").concat(t," \u7684\u6D88\u606F")),console.log("\u6240\u6709\u6D88\u606F\u53F7\u7801:",u.map(function(o){return{index:o.index,number:o.number,normalizedNumber:b(o.number),content:o.content.substring(0,20)+(o.content.length>20?"...":"")}})),i=u.filter(function(o){var g=b(o.number),d=g===t;return console.log("\u6D88\u606F ".concat(o.index," \u53F7\u7801 ").concat(o.number," \u6807\u51C6\u5316\u540E ").concat(g," \u4E0E\u8054\u7CFB\u4EBA ").concat(t," \u5339\u914D: ").concat(d)),d}).sort(function(o,g){var d=U(o.time),p=U(g.time);return d.getTime()-p.getTime()}),console.log("\u7B5B\u9009\u51FA ".concat(i.length," \u6761\u8054\u7CFB\u4EBA\u6D88\u606F:"),i.map(function(o){return{index:o.index,content:o.content.substring(0,20)+(o.content.length>20?"...":""),time:o.time}})),i.length>0?C(i):(console.log("\u6CA1\u6709\u627E\u5230\u8BE5\u8054\u7CFB\u4EBA\u7684\u6D88\u606F"),C([])),r.next=28;break;case 23:r.prev=23,r.t0=r.catch(0),console.error("\u83B7\u53D6\u8054\u7CFB\u4EBA\u6D88\u606F\u5931\u8D25:",r.t0),z.ZP.error("\u83B7\u53D6\u8054\u7CFB\u4EBA\u6D88\u606F\u5931\u8D25\uFF1A"+(r.t0 instanceof Error?r.t0.message:"\u672A\u77E5\u9519\u8BEF")),C([]);case 28:return r.prev=28,ee(!1),r.finish(28);case 31:case"end":return r.stop()}},e,null,[[0,23,28,31]])}));return function(n){return f.apply(this,arguments)}}(),Be=function(e){console.log("\u5F00\u59CB\u89E3\u6790\u77ED\u4FE1\u6570\u636E..."),console.log("\u539F\u59CB\u6570\u636E:",e);var n=[];try{var a,u=e;if(typeof e=="string")try{var t=JSON.parse(e);t.success&&t.data&&(u=t.data)}catch(N){var i=u.match(/\+CMGL:[\s\S]*?(?=\+CMGL:|$)/g);i&&(u=i.join(`
`))}for(var s=u.split(/\r?\n/).filter(function(N){return N.trim()}),r=null,o=0;o<s.length;o++){var g=s[o].trim();if(console.log("\u5904\u7406\u7B2C ".concat(o+1," \u884C:"),g),!(!g||g==="OK"||g.startsWith("AT+"))){var d=g.match(/\+CMGL: (\d+),(\d+),,(\d+)/g);if(d){var p;(p=r)!==null&&p!==void 0&&p.index&&r.pdu&&(De(r,n),r=null);var c=he()(d),m;try{for(c.s();!(m=c.n()).done;){var F=m.value,D=F.match(/\+CMGL: (\d+),(\d+),,(\d+)/);D&&(r={index:D[1],status:D[2]},console.log("\u89E3\u6790CMGL\u884C\u7ED3\u679C:",r))}}catch(N){c.e(N)}finally{c.f()}continue}if(g.startsWith("+CMGL:")){var k;(k=r)!==null&&k!==void 0&&k.index&&r.pdu&&(De(r,n),r=null);var j=g.match(/\+CMGL: (\d+),(\d+),,(\d+)/);j&&(r={index:j[1],status:j[2]})}else r&&!r.pdu&&(/^[0-9A-F]+$/i.test(g)&&(r.pdu=g,De(r,n)),r=null)}}return(a=r)!==null&&a!==void 0&&a.index&&r.pdu&&De(r,n),n}catch(N){return n}},De=function(e,n){try{if(!e.index||!e.pdu)return;var a=parseInt(e.index);if(n.some(function($){return $.index===a}))return;var u=e.pdu.replace(/\r/g,"");if(u.length<20)return;var t=Ze.Qc(u);if(t instanceof Ze.pQ){var i,s,r,o=((i=t._address)===null||i===void 0?void 0:i._phone)||"",g=((s=t._data)===null||s===void 0?void 0:s.getText())||"",d=!1,p=null;if((r=t._data)!==null&&r!==void 0&&(r=r._parts)!==null&&r!==void 0&&(r=r[0])!==null&&r!==void 0&&(r=r.header)!==null&&r!==void 0&&(r=r.ies)!==null&&r!==void 0&&(r=r[0])!==null&&r!==void 0&&r.data){var c=t._data._parts[0].header.ies[0].data;c.maxMsgNum&&c.msgRef&&c.msgSeqNo&&(p={ref:c.msgRef,total:c.maxMsgNum,seq:c.msgSeqNo},d=!0)}var m=null;if(t._serviceCenterTimeStamp){var F=t._serviceCenterTimeStamp,D=F.time,k=F.tzOff;if(D){var j=D*1e3,N=new Date().getTimezoneOffset(),R=k,v=(R+N)*60*1e3;m=new Date(j+v)}}if(o&&g){var P=re()({index:a,content:g,number:b(o),time:ln(m||new Date),type:"received",isConcatenated:d},d&&p&&{concatenatedRef:p.ref,concatenatedSeq:p.seq,concatenatedTotal:p.total});n.push(P)}}}catch($){}},br=function(e,n){try{if(!e)return null;var a="",u="",t=null,i={isConcatenated:!1,ref:0,seq:0,total:0};if(e instanceof Ze.pQ){var s,r,o,g;if(u=((s=e._address)===null||s===void 0?void 0:s._phone)||"",(r=e._data)!==null&&r!==void 0&&(r=r._parts)!==null&&r!==void 0&&(r=r[0])!==null&&r!==void 0&&(r=r.header)!==null&&r!==void 0&&(r=r.ies)!==null&&r!==void 0&&(r=r[0])!==null&&r!==void 0&&r.data){var d=e._data._parts[0].header.ies[0].data;d.maxMsgNum&&d.msgRef&&d.msgSeqNo&&(i={isConcatenated:!0,ref:d.msgRef,seq:d.msgSeqNo,total:d.maxMsgNum})}a=((o=e._data)===null||o===void 0?void 0:o.getText())||"",(g=e._serviceCenterTimeStamp)!==null&&g!==void 0&&g.time&&(t=new Date(e._serviceCenterTimeStamp.time*1e3))}return re()({index:n,content:a,number:b(u),time:ln(t||new Date),type:"received"},i.isConcatenated&&{isConcatenated:!0,concatenatedRef:i.ref,concatenatedSeq:i.seq,concatenatedTotal:i.total})}catch(p){return null}},ln=function(e){try{var n=e instanceof Date?e:new Date(e);if(isNaN(n.getTime()))return new Date().toLocaleString("zh-CN");var a=n.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),u=a.split(" "),t=Z()(u,2),i=t[0],s=t[1],r=i.split("/"),o=Z()(r,3),g=o[0],d=o[1],p=o[2];return"".concat(g.slice(-2),"/").concat(d,"/").concat(p,",").concat(s)}catch(c){return new Date().toLocaleString("zh-CN")}},b=function(e){if(!e)return"";var n=e.replace(/^\+/,"");if(n.startsWith("86")&&n.length>2){var a=n.substring(2);if(/^\d+$/.test(a))return a}if(/^\d+$/.test(n))return n;var u=n.replace(/\D/g,"");return u.length>0?u:n},ve=(0,x.useCallback)((0,On.debounce)(K()(A()().mark(function f(){var e,n,a=arguments;return A()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.length>0&&a[0]!==void 0?a[0]:!1,!tn){t.next=4;break}return console.log("\u6B63\u5728\u52A0\u8F7D\u4E2D\uFF0C\u8DF3\u8FC7\u5237\u65B0"),t.abrupt("return");case 4:return t.prev=4,console.log("\u5F00\u59CB\u5237\u65B0\u6D88\u606F\u5217\u8868"),an(!0),Ee(!0),t.next=10,J.listAllSMS();case 10:n=t.sent,console.log("\u83B7\u53D6\u77ED\u4FE1\u5217\u8868\u54CD\u5E94:",n),n!=null&&n.success?gr(n):(console.error("\u83B7\u53D6\u77ED\u4FE1\u5217\u8868\u5931\u8D25:",n==null?void 0:n.error),z.ZP.error("\u83B7\u53D6\u77ED\u4FE1\u5217\u8868\u5931\u8D25")),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(4),console.error("\u5237\u65B0\u6D88\u606F\u5217\u8868\u5931\u8D25:",t.t0),z.ZP.error("\u83B7\u53D6\u77ED\u4FE1\u5217\u8868\u5931\u8D25\uFF1A"+(t.t0 instanceof Error?t.t0.message:"\u672A\u77E5\u9519\u8BEF"));case 19:return t.prev=19,an(!1),Ee(!1),en&&er(!1),t.finish(19);case 24:case"end":return t.stop()}},f,null,[[4,15,19,24]])})),500),[tn,B,en]),U=function(e){try{if(!e)return new Date;var n=String(e).trim();if(n.includes(",")){var a=n.split(","),u=Z()(a,2),t=u[0],i=u[1],s=t.split("/"),r=Z()(s,3),o=r[0],g=r[1],d=r[2],p=parseInt(o)<50?"20".concat(o):"19".concat(o),c="".concat(p,"-").concat(g,"-").concat(d,"T").concat(i),m=new Date(c);if(!isNaN(m.getTime()))return m}if(/^\d+$/.test(n)){var F=parseInt(n),D=F>9999999999?F:F*1e3,k=new Date(D);if(!isNaN(k.getTime()))return k}return console.warn("\u65E0\u6CD5\u89E3\u6790\u65F6\u95F4\u683C\u5F0F:",n),new Date}catch(j){return console.error("\u65F6\u95F4\u89E3\u6790\u9519\u8BEF:",e,j),new Date}},or=function(e){try{if(e.includes(",")){var n=e.split(","),a=Z()(n,2),u=a[0],t=a[1],i=u.split("/"),s=Z()(i,3),r=s[0],o=s[1],g=s[2];return"20".concat(r,"\u5E74").concat(o,"\u6708").concat(g,"\u65E5 ").concat(t)}else return e}catch(d){return console.error("Time format error:",e,d),e}},lr=function(e){var n=b(e);return/^\d{5,19}$/.test(n)},Er=function(){var f=K()(A()().mark(function e(n){var a,u;return A()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=T.find(function(s){return s.index===n}),a){i.next=3;break}return i.abrupt("return");case 3:u="\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u77ED\u4FE1\u5417\uFF1F",a.index===-1?u+=`

\u2022 \u672C\u5730\u7F13\u5B58\u6D88\u606F\uFF08\u4EC5\u4ECE\u672C\u5730\u5220\u9664\uFF09`:u+=`

\u2022 \u8BBE\u5907\u77ED\u4FE1`,u+=`

\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\u3002`,ke.Z.confirm({title:"\u786E\u8BA4\u5220\u9664",content:u,okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",okButtonProps:{danger:!0},onOk:function(){var s=K()(A()().mark(function o(){var g,d,p,c,m,F,D,k,j,N,R,v,P;return A()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(h.prev=0,ee(!0),a.index!==-1){h.next=11;break}return console.log("\u5220\u9664\u672C\u5730\u7F13\u5B58\u6D88\u606F:",((g=a.content)===null||g===void 0?void 0:g.substring(0,20))+"..."),d=Te().filter(function(E){return!(E.content===a.content&&E.number===a.number&&E.time===a.time)}),localStorage.setItem(Se,JSON.stringify(d)),C(function(E){return E.filter(function(O){return O.index!==n})}),p=T.filter(function(E){return E.index!==n}),B&&!p.some(function(E){return b(E.number)===b(B)})&&(M(function(E){return E.filter(function(O){return b(O.number)!==b(B)})}),_("")),z.ZP.success("\u672C\u5730\u7F13\u5B58\u6D88\u606F\u5DF2\u5220\u9664"),h.abrupt("return");case 11:if(c=[n],!(a.isConcatenated&&a.concatenatedRef!==void 0)){h.next=25;break}return console.log("\u5220\u9664\u5206\u6BB5\u77ED\u4FE1:",{\u5F15\u7528\u53F7:a.concatenatedRef,\u5F53\u524D\u6BB5:a.concatenatedSeq,\u603B\u6BB5\u6570:a.concatenatedTotal,\u6D88\u606F\u5185\u5BB9:((m=a.content)===null||m===void 0?void 0:m.substring(0,50))+"..."}),h.prev=14,h.next=17,J.listAllSMS();case 17:F=h.sent,F.success&&F.data&&F.data!=="OK"&&F.data!=="NO SMS"&&(D=Be(typeof F.data=="string"?F.data:JSON.stringify(F.data)),k=D.filter(function(E){return E.isConcatenated&&E.concatenatedRef===a.concatenatedRef&&b(E.number)===b(a.number)}),k.length>0?(c=k.sort(function(E,O){return E.index-O.index}).map(function(E){return E.index}),console.log("\u627E\u5230\u539F\u59CB\u5206\u6BB5\u6D88\u606F\u7D22\u5F15:",c)):(console.log("\u672A\u627E\u5230\u539F\u59CB\u5206\u6BB5\u6D88\u606F\uFF0C\u4F7F\u7528\u5F53\u524D\u7D22\u5F15"),c=[n])),h.next=25;break;case 21:h.prev=21,h.t0=h.catch(14),console.error("\u83B7\u53D6\u539F\u59CB\u5206\u6BB5\u6D88\u606F\u5931\u8D25:",h.t0),c=[n];case 25:j=he()(c),h.prev=26,j.s();case 28:if((N=j.n()).done){h.next=40;break}return R=N.value,console.log("\u5220\u9664\u77ED\u4FE1\u7D22\u5F15 ".concat(R)),h.next=33,J.sendCommand("AT+CMGD=".concat(R));case 33:if(v=h.sent,v.success){h.next=36;break}throw new Error(v.error||"\u5220\u9664\u77ED\u4FE1\u5931\u8D25");case 36:return h.next=38,new Promise(function(E){return setTimeout(E,500)});case 38:h.next=28;break;case 40:h.next=45;break;case 42:h.prev=42,h.t1=h.catch(26),j.e(h.t1);case 45:return h.prev=45,j.f(),h.finish(45);case 48:return C(function(E){return E.filter(function(O){return!c.includes(O.index)})}),P=T.filter(function(E){return!c.includes(E.index)}),B&&!P.some(function(E){return b(E.number)===b(B)})&&(M(function(E){return E.filter(function(O){return b(O.number)!==b(B)})}),_("")),h.next=53,new Promise(function(E){return setTimeout(E,1e3)});case 53:return h.next=55,Promise.all([ve(!0),we()]);case 55:z.ZP.success("\u6210\u529F\u5220\u9664".concat(c.length>1?"\u5206\u6BB5":"","\u77ED\u4FE1")),h.next=62;break;case 58:h.prev=58,h.t2=h.catch(0),console.error("\u5220\u9664\u77ED\u4FE1\u51FA\u9519:",h.t2),z.ZP.error("\u5220\u9664\u5931\u8D25\uFF1A"+(h.t2 instanceof Error?h.t2.message:"\u672A\u77E5\u9519\u8BEF"));case 62:return h.prev=62,ee(!1),h.finish(62);case 65:case"end":return h.stop()}},o,null,[[0,58,62,65],[14,21],[26,42,45,48]])}));function r(){return s.apply(this,arguments)}return r}()});case 7:case"end":return i.stop()}},e)}));return function(n){return f.apply(this,arguments)}}(),cr=function(){var f=K()(A()().mark(function e(){var n,a,u,t;return A()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(Q.length!==0){s.next=3;break}return z.ZP.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u77ED\u4FE1"),s.abrupt("return");case 3:n=T.filter(function(r){return Q.includes(r.index)}),a=n.filter(function(r){return r.index>0}),u=n.filter(function(r){return r.index===-1}),t="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684 ".concat(Q.length," \u6761\u77ED\u4FE1\u5417\uFF1F"),a.length>0&&u.length>0?t+=`

\u2022 \u8BBE\u5907\u77ED\u4FE1\uFF1A`.concat(a.length,` \u6761
\u2022 \u672C\u5730\u7F13\u5B58\uFF1A`).concat(u.length," \u6761"):u.length>0?t+=`

\u2022 \u672C\u5730\u7F13\u5B58\uFF1A`.concat(u.length," \u6761\uFF08\u4EC5\u4ECE\u672C\u5730\u5220\u9664\uFF09"):t+=`

\u2022 \u8BBE\u5907\u77ED\u4FE1\uFF1A`.concat(a.length," \u6761"),t+=`

\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\u3002`,ke.Z.confirm({title:"\u786E\u8BA4\u5220\u9664",content:t,okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",okButtonProps:{danger:!0},onOk:function(){var r=K()(A()().mark(function g(){var d,p,c,m,F,D,k,j,N,R,v,P,$,h,E,O;return A()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:S.prev=0,ee(!0),d=new Set,p=new Set,c=he()(Q),S.prev=5,F=A()().mark(function I(){var L,V,Oe,ze,ne,hn,Ae;return A()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(L=m.value,V=T.find(function(q){return q.index===L}),V){G.next=4;break}return G.abrupt("return",1);case 4:if(V.index!==-1){G.next=9;break}p.add(L),console.log("\u6807\u8BB0\u672C\u5730\u7F13\u5B58\u6D88\u606F\u5220\u9664:",((Oe=V.content)===null||Oe===void 0?void 0:Oe.substring(0,20))+"..."),G.next=25;break;case 9:if(!(V.isConcatenated&&V.concatenatedRef!==void 0)){G.next=24;break}return console.log("\u5904\u7406\u5206\u6BB5\u77ED\u4FE1\u5220\u9664:",{\u5F15\u7528\u53F7:V.concatenatedRef,\u53F7\u7801:V.number,\u6D88\u606F\u5185\u5BB9:((ze=V.content)===null||ze===void 0?void 0:ze.substring(0,50))+"..."}),G.prev=11,G.next=14,J.listAllSMS();case 14:ne=G.sent,ne.success&&ne.data&&ne.data!=="OK"&&ne.data!=="NO SMS"?(hn=Be(typeof ne.data=="string"?ne.data:JSON.stringify(ne.data)),Ae=hn.filter(function(q){return q.isConcatenated&&q.concatenatedRef===V.concatenatedRef&&b(q.number)===b(V.number)}),Ae.length>0?(Ae.forEach(function(q){d.add(q.index)}),console.log("\u627E\u5230\u539F\u59CB\u5206\u6BB5\u6D88\u606F\u7D22\u5F15:",Ae.map(function(q){return q.index}))):(d.add(L),console.log("\u672A\u627E\u5230\u539F\u59CB\u5206\u6BB5\u6D88\u606F\uFF0C\u4F7F\u7528\u5F53\u524D\u7D22\u5F15:",L))):d.add(L),G.next=22;break;case 18:G.prev=18,G.t0=G.catch(11),console.error("\u83B7\u53D6\u539F\u59CB\u5206\u6BB5\u6D88\u606F\u5931\u8D25:",G.t0),d.add(L);case 22:G.next=25;break;case 24:d.add(L);case 25:case"end":return G.stop()}},I,null,[[11,18]])}),c.s();case 8:if((m=c.n()).done){S.next=14;break}return S.delegateYield(F(),"t0",10);case 10:if(!S.t0){S.next=12;break}return S.abrupt("continue",12);case 12:S.next=8;break;case 14:S.next=19;break;case 16:S.prev=16,S.t1=S.catch(5),c.e(S.t1);case 19:return S.prev=19,c.f(),S.finish(19);case 22:if(p.size>0&&(console.log("\u5220\u9664\u672C\u5730\u7F13\u5B58\u6D88\u606F:",Array.from(p)),D=T.filter(function(I){return p.has(I.index)}),k=Te().filter(function(I){return!D.some(function(L){return L.content===I.content&&L.number===I.number&&L.time===I.time})}),localStorage.setItem(Se,JSON.stringify(k)),console.log("\u672C\u5730\u7F13\u5B58\u5DF2\u66F4\u65B0\uFF0C\u5220\u9664\u4E86",D.length,"\u6761\u6D88\u606F")),!(d.size>0)){S.next=49;break}j=Array.from(d).sort(function(I,L){return I-L}),console.log("\u5220\u9664\u8BBE\u5907\u6D88\u606F\u7D22\u5F15:",j),N=he()(j),S.prev=27,N.s();case 29:if((R=N.n()).done){S.next=41;break}return v=R.value,console.log("\u5220\u9664\u77ED\u4FE1\u7D22\u5F15 ".concat(v)),S.next=34,J.sendCommand("AT+CMGD=".concat(v));case 34:if(P=S.sent,P.success){S.next=37;break}throw new Error(P.error||"\u6279\u91CF\u5220\u9664\u77ED\u4FE1\u5931\u8D25");case 37:return S.next=39,new Promise(function(I){return setTimeout(I,500)});case 39:S.next=29;break;case 41:S.next=46;break;case 43:S.prev=43,S.t2=S.catch(27),N.e(S.t2);case 46:return S.prev=46,N.f(),S.finish(46);case 49:return $=p.size+d.size,h="\u6210\u529F\u5220\u9664 ".concat($," \u6761\u77ED\u4FE1"),p.size>0&&d.size>0?h+="\uFF08\u672C\u5730\u7F13\u5B58 ".concat(p.size," \u6761\uFF0C\u8BBE\u5907 ").concat(d.size," \u6761\uFF09"):p.size>0?h+="\uFF08\u672C\u5730\u7F13\u5B58 ".concat(p.size," \u6761\uFF09"):h+="\uFF08\u8BBE\u5907 ".concat(d.size," \u6761\uFF09"),z.ZP.success(h),ie([]),Qe(!1),E=[].concat(W()(p),W()(d)),C(function(I){return I.filter(function(L){return!E.includes(L.index)})}),O=T.filter(function(I){return!E.includes(I.index)}),B&&!O.some(function(I){return b(I.number)===b(B)})&&(M(function(I){return I.filter(function(L){return b(L.number)!==b(B)})}),_("")),S.next=61,new Promise(function(I){return setTimeout(I,1e3)});case 61:return S.next=63,Promise.all([ve(!0),we()]);case 63:S.next=69;break;case 65:S.prev=65,S.t3=S.catch(0),console.error("\u6279\u91CF\u5220\u9664\u77ED\u4FE1\u51FA\u9519:",S.t3),z.ZP.error("\u6279\u91CF\u5220\u9664\u5931\u8D25\uFF1A"+(S.t3 instanceof Error?S.t3.message:"\u672A\u77E5\u9519\u8BEF"));case 69:return S.prev=69,ee(!1),S.finish(69);case 72:case"end":return S.stop()}},g,null,[[0,65,69,72],[5,16,19,22],[27,43,46,49]])}));function o(){return r.apply(this,arguments)}return o}()});case 10:case"end":return s.stop()}},e)}));return function(){return f.apply(this,arguments)}}(),cn=function(){var f=K()(A()().mark(function e(){var n,a,u,t,i,s,r,o,g,d,p,c,m,F,D,k,j,N;return A()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(n=le.trim(),n){v.next=4;break}return z.ZP.warning("\u8BF7\u8F93\u5165\u77ED\u4FE1\u5185\u5BB9"),v.abrupt("return");case 4:if(a=B||Ne.trim(),a){v.next=8;break}return z.ZP.warning("\u8BF7\u8F93\u5165\u8054\u7CFB\u4EBA\u53F7\u7801"),v.abrupt("return");case 8:if(lr(b(a))){v.next=11;break}return z.ZP.warning("\u8BF7\u8F93\u5165\u6B63\u786E\u76845-19\u4F4D\u624B\u673A\u53F7\u7801"),v.abrupt("return");case 11:return v.prev=11,ee(!0),v.next=15,J.sendCommand("AT+CMGF?");case 15:if(u=v.sent,!(!u.success||typeof u.data=="string"&&!u.data.includes("0"))){v.next=19;break}return v.next=19,J.sendCommand("AT+CMGF=0");case 19:return v.next=21,new Promise(function(P){return setTimeout(P,1e3)});case 21:return v.next=23,J.sendCommand("AT+CSCA?");case 23:return t=v.sent,i="",t.success&&typeof t.data=="string"&&(s=t.data.match(/\+CSCA: "([^"]+)",\d+/),s&&s[1]&&(i=s[1])),r=new In,o=a.replace(/^\+/,""),!o.startsWith("86")&&o.length===11&&(o="86"+o),o.startsWith("+")||(o="+"+o),g=r.encode({smsc:i||"",destination:o,message:n,encoding:"ucs2",validityPeriod:167}),d=g.pdu,p=g.tpduLength,c="AT+CMGS=".concat(p,"\\r").concat(d),v.next=34,J.sendCommand(c);case 34:if(m=v.sent,m.success){v.next=37;break}throw new Error("\u53D1\u9001\u5931\u8D25\uFF1A"+(m.error||"\u672A\u77E5\u9519\u8BEF"));case 37:return z.ZP.success("\u53D1\u9001\u6210\u529F"),F=b(a),D={index:-1,content:n,number:F,time:new Date().toLocaleString("zh-CN",{hour12:!1,year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/(\d{2})\/(\d{2})\/(\d{2}) (\d{2}):(\d{2}):(\d{2})/,"$1/$2/$3,$4:$5:$6"),type:"sent"},sr(D),C(function(P){return[].concat(W()(P),[D])}),k=H.findIndex(function(P){return b(P.number)===F}),k>-1?(j=W()(H),j[k]=re()(re()({},j[k]),{},{lastMessage:n,lastTime:D.time,messages:[].concat(W()(j[k].messages),[D])}),M(j)):(N={number:F,lastMessage:n,lastTime:D.time,unreadCount:0,messages:[D]},M(function(P){return[N].concat(W()(P))})),ce(""),B||(_(F),Pe(""),Fe(!1)),v.next=48,ve(!0);case 48:v.next=53;break;case 50:v.prev=50,v.t0=v.catch(11),z.ZP.error("\u53D1\u9001\u5931\u8D25\uFF1A"+(v.t0 instanceof Error?v.t0.message:"\u8BF7\u68C0\u67E5\u77ED\u4FE1\u529F\u80FD\u5F00\u5173\u662F\u5426\u5173\u95ED\u6216\u5176\u4ED6\u539F\u56E0"));case 53:return v.prev=53,ee(!1),v.finish(53);case 56:case"end":return v.stop()}},e,null,[[11,50,53,56]])}));return function(){return f.apply(this,arguments)}}(),fr=function(e){e.isConcatenated&&e.concatenatedRef!==void 0?Q.includes(e.index)?ie(function(n){return n.filter(function(a){return a!==e.index})}):ie(function(n){return[].concat(W()(n),[e.index])}):Q.includes(e.index)?ie(function(n){return n.filter(function(a){return a!==e.index})}):ie(function(n){return[].concat(W()(n),[e.index])})},dr=function(e){return(0,l.jsx)(ge.Z.Item,{style:{display:"block",padding:"8px 0",marginBottom:"16px",width:"100%"},children:(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:e.type==="sent"?"flex-end":"flex-start",width:"100%"},children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:e.type==="sent"?"row-reverse":"row",alignItems:"center",gap:"8px",width:"100%"},children:[se&&(0,l.jsx)(En.Z,{checked:Q.includes(e.index),onChange:function(){return fr(e)}}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",maxWidth:"70%"},children:[(0,l.jsx)(me,{type:"secondary",style:{fontSize:"12px",marginBottom:"4px",textAlign:e.type==="sent"?"right":"left"},children:or(e.time)}),(0,l.jsxs)("div",{style:{padding:"12px 16px",background:e.type==="sent"?"#1890ff":"#f0f0f0",color:e.type==="sent"?"#fff":"inherit",borderRadius:e.type==="sent"?"16px 16px 0 16px":"16px 16px 16px 0",wordBreak:"break-word",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:[e.content||"(\u65E0\u5185\u5BB9)",e.isConcatenated&&(0,l.jsx)(me,{type:"secondary",style:{fontSize:"12px",marginLeft:"8px",color:e.type==="sent"?"#ffffff99":"inherit"},children:e.concatenatedSeq===e.concatenatedTotal?"(\u5B8C\u6574\u5206\u6BB5\u77ED\u4FE1 ".concat(e.concatenatedTotal,"/").concat(e.concatenatedTotal,")"):"(\u4E0D\u5B8C\u6574\u5206\u6BB5\u77ED\u4FE1 ".concat(e.concatenatedSeq,"/").concat(e.concatenatedTotal,")")})]})]})]})})})},fn=(0,x.useRef)(null),vr=function(){var e;(e=fn.current)===null||e===void 0||e.scrollIntoView({behavior:"smooth"})};(0,x.useEffect)(function(){vr()},[T]);var hr=function(){var f=K()(A()().mark(function e(){return A()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return Ee(!0),a.prev=1,a.next=4,Promise.all([ve(!0),we()]);case 4:a.next=10;break;case 6:a.prev=6,a.t0=a.catch(1),console.error("\u624B\u52A8\u5237\u65B0\u77ED\u4FE1\u5931\u8D25:",a.t0),z.ZP.error("\u5237\u65B0\u77ED\u4FE1\u5217\u8868\u5931\u8D25");case 10:return a.prev=10,Ee(!1),a.finish(10);case 13:case"end":return a.stop()}},e,null,[[1,6,10,13]])}));return function(){return f.apply(this,arguments)}}(),Fr=function(){var f=K()(A()().mark(function e(n){var a,u,t,i,s,r,o,g,d,p,c,m,F,D,k,j,N;return A()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,console.log("\u6536\u5230\u65B0\u77ED\u4FE1\u901A\u77E5:",n),!(!n.success||!n.data)){v.next=5;break}return console.error("\u65B0\u77ED\u4FE1\u901A\u77E5\u683C\u5F0F\u9519\u8BEF"),v.abrupt("return");case 5:u=typeof n.data=="string"?n.data.split(`
`):[],t="",i="",s="",(a=u[0])!==null&&a!==void 0&&a.startsWith("+CMGR:")&&(r=u[0].split(","),r.length>=4&&(t=r[1].replace(/["+]/g,""),o=r[3].replace(/["]/g,"").trim(),g=o.split(" "),d=Z()(g,2),p=d[0],c=d[1],m=p.split("/"),F=Z()(m,3),D=F[0],k=F[1],j=F[2],s="20".concat(D,"-").concat(k,"-").concat(j," ").concat(c))),u.length>1&&(i=u[1].trim()),t&&i&&(N={index:-1,content:i,number:b(t),time:s,type:"received"},M(function(P){var $=b(t),h=P.findIndex(function(S){return b(S.number)===$});if(h>-1){var E=W()(P),O=re()({},E[h]);return O.lastMessage=i,O.lastTime=s,O.unreadCount+=1,O.messages=[].concat(W()(O.messages),[N]),E[h]=O,E.splice(h,1),E.unshift(O),E}else{var vn={number:$,lastMessage:i,lastTime:s,unreadCount:1,messages:[N]};return[vn].concat(W()(P))}}),B&&b(B)===b(t)&&C(function(P){return[].concat(W()(P),[N])}),Fn.ZP.info({message:"\u65B0\u77ED\u4FE1 - \u6765\u81EA: ".concat(t),description:i.length>50?i.substring(0,50)+"...":i,placement:"topRight",duration:10,onClick:function(){_(b(t))}})),setTimeout(function(){ve(!0)},1e3),v.next=18;break;case 15:v.prev=15,v.t0=v.catch(0),console.error("\u5904\u7406\u65B0\u77ED\u4FE1\u901A\u77E5\u5931\u8D25:",v.t0);case 18:case"end":return v.stop()}},e,null,[[0,15]])}));return function(n){return f.apply(this,arguments)}}(),Tr=function(e){if(!(!Array.isArray(e)||e.length===0))try{var n=e.map(function(m){return{index:m.index,content:m.content||"",number:m.number||"",time:m.time||"",type:m.type==="sent"?"sent":"received"}}),a=new Map,u=he()(n),t;try{for(u.s();!(t=u.n()).done;){var i=t.value;if(i.number||i.number===""){var s=i.number||"\u672A\u77E5\u53F7\u7801",r=b(s),o=a.get(r);o||(o={number:r,lastMessage:i.content,lastTime:i.time||"",unreadCount:0,messages:[]}),o.messages.push(i);var g=i.time?U(i.time):new Date(0),d=o.lastTime?U(o.lastTime):new Date(0);g>d&&(o.lastMessage=i.content,o.lastTime=i.time||""),a.set(r,o)}else console.warn("\u77ED\u4FE1\u6CA1\u6709\u53F7\u7801\u4FE1\u606F:",i)}}catch(m){u.e(m)}finally{u.f()}var p=Array.from(a.values()).sort(function(m,F){var D=U(m.lastTime).getTime(),k=U(F.lastTime).getTime();return k-D});if(console.log("\u4ECE\u672C\u5730\u6570\u636E\u5904\u7406\u540E\u7684\u8054\u7CFB\u4EBA\u5217\u8868:",p),B){var c=p.find(function(m){return b(m.number)===b(B)});C(c?c.messages:[])}else C(n);M(p)}catch(m){console.error("\u5904\u7406\u672C\u5730\u77ED\u4FE1\u6570\u636E\u5931\u8D25:",m)}},wr=function(e,n){if(M(n),B){var a=b(B),u=n.find(function(i){return b(i.number)===a});u?(console.log("\u66F4\u65B0\u9009\u5B9A\u8054\u7CFB\u4EBA\u7684\u6D88\u606F:",u.messages.length),C(u.messages)):C([])}else{var t=W()(e).sort(function(i,s){var r=i.time?U(i.time).getTime():0,o=s.time?U(s.time).getTime():0;return r-o});C(t)}},gr=function(e){try{console.log("\u5F00\u59CB\u5904\u7406\u6D88\u606F\u6570\u636E:",e);var n=Te();if(console.log("\u672C\u5730\u7F13\u5B58\u7684\u53D1\u9001\u6D88\u606F:",n.length,"\u6761"),e.data==="OK"){console.log("\u6536\u5230OK\u54CD\u5E94\uFF0C\u53EA\u5904\u7406\u672C\u5730\u7F13\u5B58\u6D88\u606F"),n.length>0?dn(n):(C([]),M([]));return}var a=Be(e.data);console.log("\u89E3\u6790\u5230\u7684\u77ED\u4FE1:",a);var u=[].concat(W()(a),W()(n));if(console.log("\u5408\u5E76\u540E\u7684\u6240\u6709\u6D88\u606F:",u.length,"\u6761"),u.length>0){var t=mr(u);console.log("\u5904\u7406\u5206\u6BB5\u77ED\u4FE1\u540E\u7684\u6D88\u606F:",t),dn(t)}else C([]),M([])}catch(i){console.error("\u5904\u7406\u6D88\u606F\u6570\u636E\u5931\u8D25:",i),C([]),M([])}},dn=function(e){var n=new Map;e.forEach(function(t){var i=b(t.number);if(!i){console.warn("\u77ED\u4FE1\u6CA1\u6709\u6709\u6548\u7684\u624B\u673A\u53F7:",t);return}var s=n.get(i);s||(s={number:i,lastMessage:t.content,lastTime:t.time,unreadCount:0,messages:[]},n.set(i,s)),s.messages.push(t);var r=U(t.time),o=s.lastTime?U(s.lastTime):new Date(0);r>o&&(s.lastMessage=t.content,s.lastTime=t.time)});var a=Array.from(n.values());if(M(a),B){var u=a.find(function(t){return b(t.number)===b(B)});u&&(console.log("\u66F4\u65B0\u9009\u4E2D\u8054\u7CFB\u4EBA\u7684\u6D88\u606F:",u.messages),C(u.messages))}else console.log("\u8BBE\u7F6E\u6240\u6709\u6D88\u606F:",e),C(e)};(0,x.useEffect)(function(){console.log("\u8054\u7CFB\u4EBA\u5217\u8868\u5DF2\u66F4\u65B0:",H)},[H]),(0,x.useEffect)(function(){console.log("\u6D88\u606F\u5217\u8868\u5DF2\u66F4\u65B0:",T)},[T]);var mr=function(e){console.log("\u5F00\u59CB\u5904\u7406\u5206\u6BB5\u77ED\u4FE1...");var n=new Map,a=[];e.forEach(function(t){var i;if(!t.isConcatenated){a.push(t);return}if(t.concatenatedRef===void 0||t.concatenatedSeq===void 0||t.concatenatedTotal===void 0){console.warn("\u5206\u6BB5\u77ED\u4FE1\u7F3A\u5C11\u5FC5\u8981\u4FE1\u606F:",t),a.push(t);return}var s="".concat(t.number,"-").concat(t.concatenatedRef);console.log("\u5904\u7406\u5206\u6BB5\u77ED\u4FE1:",{key:s,\u53F7\u7801:t.number,\u5F15\u7528\u53F7:t.concatenatedRef,\u5E8F\u53F7:t.concatenatedSeq,\u603B\u6570:t.concatenatedTotal,\u5185\u5BB9:((i=t.content)===null||i===void 0?void 0:i.substring(0,20))+"..."}),n.has(t.number)||n.set(t.number,new Map);var r=n.get(t.number);r.has(t.concatenatedRef)||r.set(t.concatenatedRef,{ref:t.concatenatedRef,total:t.concatenatedTotal,messages:new Array(t.concatenatedTotal),isComplete:!1,number:t.number});var o=r.get(t.concatenatedRef),g=t.concatenatedSeq-1;g>=0&&g<o.total?(o.messages[g]=t,o.isComplete=o.messages.filter(function(d){return d!==void 0}).length===o.total):(console.warn("\u5206\u6BB5\u77ED\u4FE1\u5E8F\u53F7\u8D85\u51FA\u8303\u56F4:",{\u5E8F\u53F7:t.concatenatedSeq,\u603B\u6BB5\u6570:o.total,\u6D88\u606F:t}),a.push(t))});var u=[].concat(a);return n.forEach(function(t,i){t.forEach(function(s){if(console.log("\u68C0\u67E5\u5206\u6BB5\u77ED\u4FE1\u7EC4: \u53F7\u7801=".concat(i,", \u5F15\u7528\u53F7=").concat(s.ref,", \u603B\u6BB5\u6570=").concat(s.total,", \u5B8C\u6574\u6027=").concat(s.isComplete)),console.log("\u5F53\u524D\u7EC4\u7684\u6D88\u606F:",s.messages.map(function(c,m){var F;return c?"\u6BB5".concat(m+1,": ").concat((F=c.content)===null||F===void 0?void 0:F.substring(0,20),"..."):"\u6BB5".concat(m+1,": \u7F3A\u5931")})),s.isComplete){var r=s.messages.filter(function(c){return c!==void 0}).sort(function(c,m){return(c.concatenatedSeq||0)-(m.concatenatedSeq||0)}),o=r.every(function(c,m){return c.concatenatedSeq===m+1});if(!o){console.warn("\u5206\u6BB5\u77ED\u4FE1\u987A\u5E8F\u4E0D\u8FDE\u7EED:",{\u53F7\u7801:i,\u5F15\u7528\u53F7:s.ref,\u6D88\u606F:r.map(function(c){var m;return{\u5E8F\u53F7:c.concatenatedSeq,\u5185\u5BB9:((m=c.content)===null||m===void 0?void 0:m.substring(0,20))+"..."}})}),s.messages.forEach(function(c){c&&u.push(c)});return}var g=r.map(function(c){return c.content||""}).join(""),d=r[0],p=re()(re()({},d),{},{content:g,isConcatenated:!0,concatenatedRef:s.ref,concatenatedSeq:s.total,concatenatedTotal:s.total,index:d.index});console.log("\u5408\u5E76\u540E\u7684\u6D88\u606F:",{\u53F7\u7801:p.number,\u5185\u5BB9\u957F\u5EA6:p.content.length,\u5185\u5BB9\u9884\u89C8:p.content.substring(0,50)+"...",\u5206\u6BB5\u6570:s.total,\u5F15\u7528\u53F7:s.ref}),u.push(p)}else console.log("\u4E0D\u5B8C\u6574\u7684\u5206\u6BB5\u77ED\u4FE1\u7EC4: \u53F7\u7801=".concat(i,", \u5F15\u7528\u53F7=").concat(s.ref)),s.messages.forEach(function(c){c&&u.push(c)})})}),u.sort(function(t,i){var s=U(t.time).getTime(),r=U(i.time).getTime();return s===r?t.index-i.index:s-r})};return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(Tn.Z,{title:(0,l.jsxs)(je.Z,{children:[(0,l.jsx)("span",{children:"\u77ED\u4FE1\u4E2D\u5FC3"}),(0,l.jsxs)("span",{style:{fontSize:"14px",fontWeight:"normal",color:"#999"},children:["\u5B58\u50A8\u7A7A\u95F4: ",de.used,"/",de.total,(0,l.jsx)(wn.Z,{percent:Math.round(de.used/de.total*100),status:de.used>=de.total?"exception":"normal",showInfo:!1,style:{width:"80px",marginLeft:"8px",display:"inline-block"},size:"small"})]})]}),extra:(0,l.jsxs)(je.Z,{children:[(0,l.jsx)(te.ZP,{type:"primary",icon:(0,l.jsx)(xe.Z,{}),onClick:function(){return Fe(!0)},disabled:!Re||!pe,title:Re?pe?"":"IMS\u529F\u80FD\u672A\u5F00\u542F":"\u77ED\u4FE1\u529F\u80FD\u672A\u5F00\u542F",children:"\u53D1\u9001\u65B0\u77ED\u4FE1"}),B&&(0,l.jsxs)(je.Z,{children:[(0,l.jsx)(te.ZP,{danger:se,onClick:function(){return Qe(!se)},children:se?"\u53D6\u6D88\u6279\u91CF\u5220\u9664":"\u6279\u91CF\u5220\u9664"}),se&&(0,l.jsx)(te.ZP,{onClick:function(){Q.length===T.length?ie([]):ie(T.map(function(e){return e.index}))},children:Q.length===T.length?"\u53D6\u6D88\u5168\u9009":"\u5168\u9009"})]}),(0,l.jsx)(te.ZP,{onClick:hr,icon:(0,l.jsx)(An.Z,{spin:Kn}),loading:fe,children:"\u5237\u65B0"})]}),children:[(0,l.jsxs)(Me.Z,{style:{background:"#fff",minHeight:"70vh",height:"100%"},children:[(0,l.jsx)(zn,{width:300,style:{background:"#fff",borderRight:"1px solid #f0f0f0"},breakpoint:"lg",collapsedWidth:0,children:(0,l.jsx)(ge.Z,{loading:fe,dataSource:H,style:{overflowY:"auto",height:"calc(100vh - 200px)"},renderItem:function(e){var n;return(0,l.jsxs)(ge.Z.Item,{style:{cursor:"pointer",background:B===e.number?"#f0f0f0":"transparent",padding:"12px"},onClick:function(){return _(e.number)},children:[(0,l.jsx)(ge.Z.Item.Meta,{avatar:(0,l.jsx)(Bn.Z,{icon:(0,l.jsx)(Mn.Z,{})}),title:(0,l.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,l.jsx)(me,{strong:!0,children:e.number})}),description:((n=e.messages)===null||n===void 0||(n=n[e.messages.length-1])===null||n===void 0?void 0:n.content)||e.lastMessage}),e.unreadCount>0&&(0,l.jsx)(Dn.Z,{count:e.unreadCount,style:{marginLeft:8}})]})}})}),(0,l.jsx)(Ln,{style:{padding:"0 24px"},children:B?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{height:"calc(70vh - 150px)",overflowY:"auto",padding:"24px 0",display:"flex",flexDirection:"column"},children:T.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ge.Z,{dataSource:T.sort(function(f,e){var n=U(f.time),a=U(e.time);return n.getTime()-a.getTime()}),renderItem:dr,style:{display:"flex",flexDirection:"column"}}),(0,l.jsx)("div",{ref:fn})]}):(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",flexDirection:"column",gap:"16px"},children:fe?(0,l.jsx)("div",{children:"\u52A0\u8F7D\u4E2D..."}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(kn.Z,{style:{fontSize:"32px",color:"#d9d9d9"}}),(0,l.jsx)(me,{type:"secondary",children:"\u6CA1\u6709\u6D88\u606F\u8BB0\u5F55"})]})})}),se&&Q.length>0&&(0,l.jsx)("div",{style:{textAlign:"center",padding:"16px 0"},children:(0,l.jsxs)(te.ZP,{type:"primary",danger:!0,onClick:function(){return cr()},loading:fe,children:["\u5220\u9664\u9009\u4E2D\u7684 ",Q.length," \u6761\u77ED\u4FE1"]})}),!se&&(0,l.jsxs)("div",{style:{borderTop:"1px solid #f0f0f0",padding:"12px 8px",display:"flex",gap:"8px",background:"#fff"},children:[(0,l.jsx)(Ue,{value:le,onChange:function(e){return ce(e.target.value)},placeholder:pe?"\u8BF7\u8F93\u5165\u77ED\u4FE1\u5185\u5BB9":"IMS\u529F\u80FD\u672A\u5F00\u542F\uFF0C\u65E0\u6CD5\u53D1\u9001\u77ED\u4FE1",autoSize:{minRows:2,maxRows:4},style:{flex:1},disabled:!pe}),(0,l.jsx)(te.ZP,{type:"primary",icon:(0,l.jsx)(xe.Z,{}),onClick:cn,loading:fe,style:{height:"auto"},disabled:!pe,children:"\u53D1\u9001"})]})]}):(0,l.jsx)("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(me,{type:"secondary",children:'\u9009\u62E9\u8054\u7CFB\u4EBA\u6216\u70B9\u51FB"\u53D1\u9001\u65B0\u77ED\u4FE1"\u6309\u94AE\u5F00\u59CB\u65B0\u5BF9\u8BDD'})})})]}),(0,l.jsx)(ke.Z,{title:"\u53D1\u9001\u65B0\u77ED\u4FE1",open:Qn,onCancel:function(){Fe(!1),Pe(""),ce("")},footer:null,children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsx)(Ge.Z,{placeholder:"\u8BF7\u8F93\u5165\u65B0\u8054\u7CFB\u4EBA\u53F7\u7801",value:Ne,onChange:function(e){return Pe(e.target.value)}}),(0,l.jsx)(Ue,{value:le,onChange:function(e){return ce(e.target.value)},placeholder:"\u8BF7\u8F93\u5165\u77ED\u4FE1\u5185\u5BB9",autoSize:{minRows:4,maxRows:6}}),(0,l.jsx)(te.ZP,{type:"primary",icon:(0,l.jsx)(xe.Z,{}),onClick:function(){cn(),Ne&&le&&Fe(!1)},loading:fe,block:!0,children:"\u53D1\u9001"})]})})]})})},Un=Gn}}]);
